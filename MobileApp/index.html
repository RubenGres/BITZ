<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Species Quest</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container mt-4">
        <div id="page1">
            <h2>Choose Location ğŸ“</h2>
            <label for="place_name" class="form-label">Enter place name or scroll on the map:</label>
            
            <input type="text" id="place_name" class="form-control" placeholder="e.g. Paris, France">
            <div class="mb-3">
                <button class="btn btn-primary" onclick="searchPlace()">Find Place</button>
            </div>
            
            <div id="map-container" style="position: relative;">
                <div id="map" style="height: 500px;"></div>
                <div id="map-cursor"></div>
                <div id="coordinates">Lat: - | Lon: -</div>
            </div>

            <div class="text-center mt-3">
                <button class="btn btn-success" onclick="goToPage(2)">Confirm Location</button>
            </div>
        </div>
        
        <!-- Rest of the previous HTML remains the same -->
        <div id="page2" style="display: none;">
            <h2>Here are species around you ğŸ•µï¸â€â™€ï¸</h2>
            <div id="species-container" class="bubble-container mt-3"></div>
            <div class="text-center mt-3">
                <button class="btn btn-success" onclick="goToPage(3)">Start Quest</button>
            </div>
        </div>

        <div id="page3" style="display: none;">
            <h2>Species Quest ğŸŒ±</h2>
            <div id="chat-box" class="border p-3 mb-3" style="height: 400px; overflow-y: auto;"></div>
            
            <!-- Spinner -->
            <div id="spinner" class="text-center" style="display: none;">
                <div class="spinner-border text-success" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <div class="input-group mb-2">
                <input type="text" id="user-input" class="form-control" placeholder="Type your message...">
                <button class="btn btn-success" onclick="sendMessage()">Send</button>
            </div>

            <div id="image-upload-container" class="mb-2">
                <input type="file" id="image-upload" accept="image/*" capture="environment" style="display:none;">
                <button class="btn btn-outline-secondary" onclick="document.getElementById('image-upload').click()">
                    ğŸ“· Take Photo
                </button>
                <img id="image-preview" src="" style="display:none;">
            </div>
            
            <textarea name="system_prompt" id="system_prompt" rows="10" class="form" style="width: 100%;">
You are a helpful assistant helping users identify the biodiversity around them.
Ask for pictures of what there is to see around the user and request images of specific species, providing detailed instructions.

The flow is as follows:
1. The user submits an image of a species (insect, bird, animal, plant, etc.).
2. You analyze the image and return an ecological fact about the species.
3. You propose a new idea to explore more species.
4. Repeat from step 1.

Use pictures from the user's environment to guide them in their quest to discover species.
When instructing them on which species to look for and how, ask for a picture as confirmation.
If an image is provided, try to identify the species and return a brief fact (maximum 3 lines, no more than 5 sentences total).

The user is based in {user_location}. Ask them to take a picture of their surroundings to initiate the hunt.
            </textarea>

        </div>

    </div>

    <script src="oaak.js"></script>
</body>
</html>